/*!
 * backbone.viewcache.js v1.0.0
 * Copyright 2014, Ingmar Hergst
 * backbone.viewcache.js may be freely distributed under the MIT license.
 */
!function(e,n){if("function"==typeof define&&define.amd)define(["backbone","underscore","jquery"],n);else if("object"==typeof exports){var o=require("backbone"),i=require("underscore");o.$=o.$||require("jquery"),module.exports=n(o,i,o.$)}else n(e.Backbone,e._,e.Backbone.$)}(this,function(e,n,o,i){function r(){var e=p.checkExpireds||p.cacheExpiry;e&&(f=n.now()+1e3*e)}function c(n,o){var i;p.retainScrollPosition&&(i=e.ViewCache.get(o),i&&i[n+"ScrollPosition"]())}function t(e){delete d[e]}function s(e){var o=d[e],i=o&&o._cacheExpiry;i&&n.now()>i&&t(e)}function l(e){var n,o=e?s:t;for(n in d)d.hasOwnProperty(n)&&o(n)}function a(o){return n.isUndefined(o)?e.history.fragment:o}var u,f,h={retainScrollPosition:!0,scrollElement:window,cacheExpiry:i,checkExpireds:i},p=h,d={},x=!1;return n.extend(e.View.prototype,{saveScrollPosition:function(){this._scrollPosition=o(p.scrollElement).scrollTop()},restoreScrollPosition:function(){this._scrollPosition&&o(p.scrollElement).scrollTop(this._scrollPosition)},setCacheExpiry:function(e){e&&(this._cacheExpiry=n.now()+1e3*e,x=!0)}}),e.ViewCache={config:function(e){return e&&(e.checkExpireds||(e.checkExpireds=e.cacheExpiry||h.cacheExpiry),p=n.defaults(e,h)),p},get:function(e){return e=a(e),s(e),d[e]},set:function(e,n){return n=a(n),e.setCacheExpiry(p.cacheExpiry),x&&r(),d[n]=e,e},remove:function(e){e=a(e),t(e)},clear:l,clearExpireds:function(){l(!0)},beforeRoute:function(){n.isUndefined(u)||(c("save",u),this.lastUrlFragment=u,x&&n.now()>f&&(l(!0),r()))},afterRoute:function(){var e=a();c("restore",e),u=e}},e.ViewCache});