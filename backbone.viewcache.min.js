/*!
 * backbone.viewcache.js v1.1.0
 * Copyright 2015, Ingmar Hergst
 * backbone.viewcache.js may be freely distributed under the MIT license.
 */
!function(e,o){if("function"==typeof define&&define.amd)define(["backbone","underscore","jquery"],o);else if("object"==typeof exports){var n=require("backbone"),r=require("underscore");n.$=n.$||require("jquery"),module.exports=o(n,r,n.$)}else o(e.Backbone,e._,e.Backbone.$)}(this,function(e,o,n,r){function i(){var e=h.checkExpireds||h.cacheExpiry;e&&(f=o.now()+1e3*e)}function c(o,n){var r;h.retainScrollPosition&&(r=e.ViewCache.get(n),r&&r[o+"ScrollPosition"]())}function t(e){delete d[e]}function s(e){var n=d[e],r=n&&n._cacheExpiry;r&&o.now()>r&&t(e)}function l(e){var o,n=e?s:t;for(o in d)d.hasOwnProperty(o)&&n(o)}function a(n){return o.isUndefined(n)?e.history.fragment:n}var u,f,p={retainScrollPosition:!0,scrollElement:window,cacheExpiry:r,checkExpireds:r,scrollToTopByDefault:!0},h=p,d={},y=!1;return o.extend(e.View.prototype,{saveScrollPosition:function(){this._scrollPosition=n(h.scrollElement).scrollTop()},restoreScrollPosition:function(){this._scrollPosition?n(h.scrollElement).scrollTop(this._scrollPosition):h.scrollToTopByDefault&&n(h.scrollElement).scrollTop(0)},setCacheExpiry:function(e){e&&(this._cacheExpiry=o.now()+1e3*e,y=!0)}}),e.ViewCache={config:function(e){return e&&(e.checkExpireds||(e.checkExpireds=e.cacheExpiry||p.cacheExpiry),h=o.defaults(e,p)),h},get:function(e){return e=a(e),s(e),d[e]},set:function(e,o){return o=a(o),e.setCacheExpiry(h.cacheExpiry),y&&i(),d[o]=e,e},remove:function(e){e=a(e),t(e)},clear:l,clearExpireds:function(){l(!0)},beforeRoute:function(){o.isUndefined(u)||(c("save",u),this.lastUrlFragment=u,y&&o.now()>f&&(l(!0),i()))},afterRoute:function(){var e=a();c("restore",e),u=e}},e.ViewCache});